<html>

<head>
<script type="text/javascript">
var getWeek_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/getweek";
var createMeeting_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/createmeeting";
var cancelMeeting_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/cancelmeeting";
var searchOpen_url = "";
var getAllSchedules_url ="https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/getallschedules";



function processResponse(result) {
  var table = document.getElementById('weekDisplay');
  var js = JSON.parse(result);
  
  var week = js["week"];
  var blockHTML = "<tr> <td> Monday </td> <td> Tuesday </td> <td> Wensday </td> <td> Thursday </td> <td> Friday </td> </tr> ";
  	for(var timeslot = 0; timeslot < week["days"][0]["timeslots"].length; timeslot++){
  		blockHTML+= "<tr>";
  		for(var day = 0; day < 5; day++){
  		blockHTMl += "<td>";
  		var blockData = week[day][timeslot];
  		blockHTML += "<p>Time: " + blockData["time"]["hour"] + ":" + blockData["time"]["minute"];
  		if(week["days"][day]["timeslots"][timeslot]["open"] == true){
		if(week["days"][day]["timeslots"][timeslot]["user"]=""){
  		blockHTML+= "\n</p><p><button onClick=\"createMeeting(" + ["days"][day]["timeslots"][timeslot]["id"] + ", "Shabalaba")>CreateMeeting</button></p><p><button onClick=\"closeTimeslot(" + ["days"][day]["timeslots"][timeslot]["id"] + ")>Close</button></p>";
  		}
  		else{
  		blockHTML+= "\n</p><p>RESERVED</p><button>Cancel Meeting</button><p></p>";
  		}
  		}
  		else{
  		
  		blockHTML += "\n</p><p>"CLOSED"</p><p><button>Open</button></p>";}
  		}
  		blockHTML += "</td>";
  		}
  		blockHTML += "</tr>";
  		}
  		table.innerHTML = blockHTML;
  		}

  		
  		



function handleDisplayWeek() {
  var schedId = document.getElementById("schedId").value;
  var date = document.getElementById("date").value;

  
  var data = {};
  data["schedId"] = parseInt(schedId);
  data["date"] = date;


  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("GET", getWeek_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processResponse();
    } else {
      processResponse();
    }
  };
}

function createMeeting(id, user) {
var createMeetingId = parseInt(id);
var user = user;

var data = {};
data["closeTimeslotId"] = createMeetingId;
date["user"] = user;

 var js = JSON.stringify(data);
 console.log("JS:" + js);
 var xhr = new XMLHttpRequest();
 xhr.open("POST", createMeeting_url, true);
 
 // send the collected data as JSON
  xhr.send(js);

// This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      handleDisplayWeek();
    } else {
      handleDisplayWeek();
    }
  };
}

function cancelMeeting(id, password) {
var cancelMeetingId = pasreInt(id);
var password = password;

var data = {};
data["cancelMeetingId"] = parseInt(cancelMeetingId);
data["password"] = password;

 var js = JSON.stringify(data);
 console.log("JS:" + js);
 var xhr = new XMLHttpRequest();
 xhr.open("POST", cancelMeeting_url, true);
 
 // send the collected data as JSON
  xhr.send(js);

// This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      handleDisplayWeek();
    } else {
      handleDisplayWeek();
    }
  };
}






</script>











</head>

<title>ParticipantView</title>
<style>
	.box{

	background-color:grey;
	margin:120px auto;
	color:black;
	width:300px;
	height:175px;
	margin-bottom:50px;
	margin-top:0px;
	.textarea{
	margin-left:20px;
	margin-right:20px;
	margin-top: 20px;
	margin-bottom:20px;
	}
	
	</style>
<body>

<p>
Schedule List:

<table id="schedList"></table>
</p>
<hr width=100%></hr>

<p id="scheduleName">
</p>





<button style = "float: left; margin-left: 790px; margin-top: 15px"> Select Schedule </button>
<button style = "float: left; margin-left: 50px; margin-top: 15px"> Retrieve Open Time Slots </button> 
<hr style= "float: left; width: 100%; height:1px;" />
<div class="box" style = "position: relative; left: -800px; bottom: -685">
<p style= "text-align: center"> Enter secret code to edit meeting </p>
<input type="text" name="dayInput" align style = "margin-top: 15px; margin-left: 45px; margin-right: 5px; float: left" size= "20"/>
<button style = "margin-top: 15px"> GO! </button>
</div>
<div class="box"  style = "position: relative; left: 800px; bottom: -450">
<p style= "text-align: center"> Enter participants for new meeting </p>
<input type="text" name="dayInput" align style = "margin-left: 60" size= "20"/>
<p style= "text-align: center"> Secret Code to access this meeting in the future: xQiD3JLbF87 </p>
<button style = "float: center; margin-top: 15px; margin-left: 130px"> GO! </button>
</div>
<table id='weekDisplay' border="1">

</table>
</body>
</html>