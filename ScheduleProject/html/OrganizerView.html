<html>
<head>
<script type="text/javascript">
var create_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/createschedule";
var delete_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/deleteschedule";
var cancelMeeting_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/cancelmeeting";
var openTimeslot_url = "";
var closeTimeslot_url = "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/closetimeslot";
var getAllSchedules_url ="https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/getallschedules";
var getWeek_url =  "https://7au48di44j.execute-api.us-east-2.amazonaws.com/Alpha/getweek";







function processResponse(result) {
  var table = document.getElementById('weekDisplay');
  var js = JSON.parse(result);
  
  var timeslotList = js["timeslotList"];
  var blockHTML = "<tr> <td> Monday </td> <td> Tuesday </td> <td> Wensday </td> <td> Thursday </td> <td> Friday </td> </tr> ";
  for (var timeslot = 0; timeslot < timeslotList[0].length; timeslot++) {
  	blockHTML += "<tr>";
    for (var day = 0; day < 5; day++) {
      blockHTML += "<td>";
      if (day >= js["startingIndex"]){
        var blockData = timeslotList[day - js["startingIndex"]][timeslot];
       if(week["days"][day]["timeslots"][timeslot]["open"] == true){
		if(week["days"][day]["timeslots"][timeslot]["user"]=""){
  		  blockHTML+= "\n</p><p><button>CreateMeeting</button></p><p><button onClick=\"closeTimeslot(" + ["days"][day]["timeslots"][timeslot]["id"] + ")>Close</button></p>";
  		}
  		else{
  		  blockHTML+= "\n</p><p>RESERVED</p><button>Cancel Meeting</button><p></p>";
  	    }
  	   }
  	   else{
  		
  		blockHTML += "\n</p><p>CLOSED</p><p><button>Open</button></p>";
  		}
  	   }
  	   blockHTML += "</td>";
  	  }
  	blockHTML += "</tr>";
   }
  table.innerHTML = blockHTML;
  		

  // Can grab any DIV or SPAN HTML element and can then manipulate its
  // contents dynamically via javascript

  var computation = js["name"];

  // Update computation result
  var weekDisplay = document.getElementById('schedList');
  weekDisplay.innerHTML = "<tr> <td>" + computation + "</td> </tr>";
}



function handleCreate() {
  var name = document.getElementById("name").value;
  var startDate = document.getElementById("startDate").value;
  var endDate = document.getElementById("endDate").value;
  var startTime = document.getElementById("startTime").value;
  var endTime = document.getElementById("endTime").value;
  var timeslotLen = parseInt(document.getElementById("timeslotLen").value);
  
  var data = {};
  data["name"] = name;
  data["startDate"] = startDate;
  data["endDate"] = endDate;
  data["startTime"] = startTime;
  data["endTime"] = endTime;
  data["timeslotLen"] = timeslotLen

  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("POST", create_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processResponse(xhr.responseText);
    } else {
      processResponse("N/A");
    }
  };
}



function promptWeek(id){
var id = parseInt(prompt("Enter id"));
var date = Date.parse(prompt("Enter a date in the format of dd/mm/yyyy"));
handleDisplayWeek(id, date);
}

function processGetSchedules(result){
var scheduleListHTMLCode = document.getElementById('scheduleName');
var js = JSON.parse(result);

var schedListItems = js["schedList"];
var listHTML = "<dl>";
	for(var i = 0; i<schedListItems.length; i++){
	listHTML += "<dt>" + schedListItems[i]["name"] + "<button onClick=" + "JavaScript:promptWeek()" + ">View Schedule</button>" +"</dt>";
	}
	listHTML += "</ul>";
	scheduleListHTMLCode.innerHTML = listHTML;
}




function handleGetSchedules(){
  var data = {};
  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("GET", getAllSchedules_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processGetSchedules(xhr.responseText);
    } else {
      processGetSchedules("N/A");
    }
  };
}





function handleDisplayWeek( schedId, date) {
  //var schedId = document.getElementById("schedId").value;
  //var date = document.getElementById("date").value;
	var schedId = schedId;
	var date = date;
  
  var data = {};
  data["schedId"] = parseInt(schedId);
  data["date"] = date;


  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("GET", getWeek_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processGetWeek(xhr.responseText);
    } else {
      processGetWeek("N/A");
    }
  };
}

function processGetWeek(result){
  var table = document.getElementById('weekDisplay');
  var js = JSON.parse(result);
  
  var week = js["week"];
  var blockHTML = "<tr> <td> Monday </td> <td> Tuesday </td> <td> Wensday </td> <td> Thursday </td> <td> Friday </td> </tr> ";
  if(week["days"]>0){
  for(var i = 0; i < week["days"][0]["timeslots"].length; i++){
    blockHTML += "<tr>";
    for(var j = 0; j < 5; j++){
      blockHTML += "<td>";
      for(var k = 0; k < week["days"].length; k++){
        if(week["days"][k]["weekday"] == j){
          if(week["days"][k]["timeslots"][i]["open"] == true){
		    if(week["days"][k]["timeslots"][i]["user"]=""){
  		      blockHTML+= "\n</p><p><button>CreateMeeting</button></p><p><button onClick=\"closeTimeslot(" + ["days"][k]["timeslots"][i]["id"] + ")>Close</button></p>";
  		    }
  		    else{
  		      blockHTML+= "\n</p><p>RESERVED</p><button>Cancel Meeting</button><p></p>";
  	        }
  	      }
  	      else{
  		
  		  blockHTML += "\n</p><p>CLOSED</p><p><button>Open</button></p>";}
  	      }
  	    }
  	    blockHTML += "</td>";
  	  }
  	  blockHTML += "</tr>";
    }
  }
    table.innerHTML = blockHTML;
      
      
}


/*function closeTimeslot(id, password, schedId) {
var closeTimeslotId = pasreInt(id);
var password = password;
var schedId = schedId;

var data = {};
data["id"] = closeTimeslotId;
data["password"] = password;
data["schedId"] = schedId;

 var js = JSON.stringify(data);
 console.log("JS:" + js);
 var xhr = new XMLHttpRequest();
 xhr.open("POST", closeTimeslot_url, true);
 
 // send the collected data as JSON
  xhr.send(js);

// This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      handleDisplayWeek();
    } else {
      handleDisplayWeek();
    }
  };
}

function openTimeslot(id) {
var openTimeslotId = pasreInt(id);

var data = {};
data["id"] = openTimeslotId;

 var js = JSON.stringify(data);
 console.log("JS:" + js);
 var xhr = new XMLHttpRequest();
 xhr.open("POST", openTimeslot_url, true);
 
 // send the collected data as JSON
  xhr.send(js);

// This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      handleDisplayWeek();
    } else {
      handleDisplayWeek();
    }
  };
  }
  
function delete(id, password) {
var deleteId = pasreInt(id);
var password = password;

var data = {};
data["id"] = deleteId;
data["password"] = password;

 var js = JSON.stringify(data);
 console.log("JS:" + js);
 var xhr = new XMLHttpRequest();
 xhr.open("POST", delete_url, true);
 
 // send the collected data as JSON
  xhr.send(js);

// This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      handleDisplayWeek();
    } else {
      handleDisplayWeek();
    }
  };  
  }
  
function cancelMeeting(id, password) {
var cancelMeetingId = pasreInt(id);
var password = password;

var data = {};
data["cancelMeetingId"] = parseInt(cancelMeetingId);
data["password"] = password;

 var js = JSON.stringify(data);
 console.log("JS:" + js);
 var xhr = new XMLHttpRequest();
 xhr.open("POST", cancelMeeting_url, true);
 
 // send the collected data as JSON
  xhr.send(js);

// This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      handleDisplayWeek();
    } else {
      handleDisplayWeek();
    }
  };
} */

</script>
</head>

<body>
<p>
<a>name</a>
<input id="name"></input>
<a>start date</a>
<input type="date" id="startDate"></input>

<a>end date</a>
<input type="date" id="endDate"></input>
<a>start time</a>
<input type="time" id="startTime"></input>
<a>end time</a>
<input type="time" id="endTime"></input>
<a>timeslot len (min)</a>
<select id="timeslotLen">
	<option value = "10">10</option>
	<option value = "15">15</option>
	<option value = "30">30</option>
	<option value = "60">60</option>
</select>
<input type="button" value="Create Schedule"  onClick="JavaScript:handleCreate(this)">
</p>
<p>
<button onClick="JavaScript:handleGetSchedules()">Display Schedules</button>
Schedule List: 


</p>
<hr width=100%></hr>

<p id="scheduleName">
</p>

<p>
<button>add time to begining</button>
<button border-color="red">Delete Schedule</button>
<button>add time to end</button>
</p>
<p>
<input type"date" id="date" placeholder="Enter Week"></input>
<button>Display</button>
</p>
<p>
<table id='weekDisplay' border="1">

</table>
</p>
</body>
</html>